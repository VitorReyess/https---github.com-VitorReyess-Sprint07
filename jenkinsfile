// sprint 7/Jenkinsfile
pipeline {
    agent any

    stages {
        stage('Checkout do C√≥digo') {
            steps {
                git url: 'https://github.com/<SEU_USUARIO>/<SEU_REPOSITORIO>.git',
                    credentialsId: '<ID_DA_SUA_CREDENTIAL_NO_JENKINS>', // Mantenha vazio se o repo for p√∫blico ou se for SSH key configurada diretamente no agente
                    branch: 'main' // ou 'master', dependendo do nome da sua branch principal
            }
        }
        stage('Build Simples') {
            steps {
                echo "Iniciando build simulado para os microsservi√ßos da Vinheria Agnello..."
                script {
                    // Simula "build" verificando arquivos
                    echo "Verificando arquivos em servico-produtos..."
                    sh 'ls -la servico-produtos/'
                    echo "Verificando arquivos em servico-pedidos..."
                    sh 'ls -la servico-pedidos/'
                }
                echo "Build simulado conclu√≠do com sucesso!"
            }
        }
        stage('Deploy em Pasta de Publica√ß√£o') {
            steps {
                echo "Iniciando deploy simulado dos microsservi√ßos para ambiente de produ√ß√£o..."
                script {
                    // Define um diret√≥rio tempor√°rio para simular o deploy
                    // Em um ambiente real, isso seria um servidor de aplica√ß√£o, kubernetes, etc.
                    def deployDir = "/tmp/vinheria_deploy_${env.BUILD_NUMBER}" // Usa n√∫mero do build para pastas √∫nicas
                    sh "mkdir -p ${deployDir}/servico-produtos"
                    sh "mkdir -p ${deployDir}/servico-pedidos"

                    // Copia os arquivos dos servi√ßos para o diret√≥rio de deploy simulado
                    sh "cp -R servico-produtos/* ${deployDir}/servico-produtos/"
                    sh "cp -R servico-pedidos/* ${deployDir}/servico-pedidos/"

                    echo "Deploy dos microsservi√ßos simulado para o diret√≥rio: ${deployDir}"
                    echo "Conte√∫do de ${deployDir}/servico-produtos:"
                    sh "ls -la ${deployDir}/servico-produtos"
                    echo "Conte√∫do de ${deployDir}/servico-pedidos:"
                    sh "ls -la ${deployDir}/servico-pedidos"
                    echo "Simula√ß√£o de restart de servi√ßos (se fosse um deploy real)..."
                }
                echo "Deploy simulado conclu√≠do!"
            }
        }
    }
    post {
        always {
            echo 'Pipeline da Vinheria Agnello finalizado.'
        }
        success {
            echo 'Status do Pipeline: SUCESSO! üéâ Tudo pronto para a pr√≥xima safra.'
        }
        failure {
            echo 'Status do Pipeline: FALHA! ÔøΩÔøΩ O deploy da Vinheria Agnello encontrou problemas.'
            // Voc√™ pode adicionar notifica√ß√µes aqui
        }
        // clean up temporary directories
        # cleanup {
        #     sh "rm -rf /tmp/vinheria_deploy_${env.BUILD_NUMBER}"
        #     echo "Diret√≥rio tempor√°rio de deploy limpo."
        # }
    }
}